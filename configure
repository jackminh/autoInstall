#!/bin/sh
LC_ALL=C
export LC_ALL
. auto/options
test -d ${AUTOINSTALL_PREFIX} || mkdir -p ${AUTOINSTALL_PREFIX}
test -d ${AUTOINSTALL_SOURCES} || mkdir -p ${AUTOINSTALL_SOURCES}
test -d ${AUTOINSTALL_TOOLS} || mkdir -p ${AUTOINSTALL_TOOLS}
test -d ${AUTOINSTALL_REPOSITORY} || mkdir -p ${AUTOINSTALL_REPOSITORY}
commond_path=$(which ${AUTOINSTALL_COMMOND})
length=$(expr length ${AUTOINSTALL_COMMOND})
[ "${commond_path:0-${length}}" == "${AUTOINSTALL_COMMOND}" ] || (echo "Please install the ${AUTOINSTALL_COMMOND}" ;exit 1)
TEMPFILE=$(mktemp)
${AUTOINSTALL_COMMOND}  update > ${TEMPFILE} 2>/dev/null
if [ $? -ne 0 ];then
	echo -e "\033[41;34mthe ${AUTOINSTALL_COMMOND} update failed,please update manually.\033[0m"
	while read line;do
		echo -e "$line"
	done < ${TEMPFILE}
	exit 1
fi
rm -rf ${TEMPFILE}
#Read the dependency library configuration file
item_lib=""
while read line; do
	#section=$(expr "${line}" : '\(^\[.*+\]$\)')
	if [ "${line:0:1}" == "#" ] ;then
		continue
	fi
	section_lib=$(expr "$line" : '\(^\[.*\]$\)')
	if [ ${#section_lib} -gt 0 ];then
		tempStr=${section_lib:1}
		sections_lib=${tempStr%]*}
	else
		item_lib=${item_lib}" "$line	

	fi
done < lib.ini
PACKAGE=($item_lib)
#endee
#Read the source configuration file
item_url=""
while read line; do
	#section=$(expr "${line}" : '\(^\[.*+\]$\)')
	if [ "${line:0:1}" == "#" ] ;then
		continue
	fi
	section_url=$(expr "$line" : '\(^\[.*\]$\)')
	if [ ${#section_url} -gt 0 ];then
		tempStr=${section_url:1}
		sections_url=${tempStr%]*}
	else
		item_url=${item_url}" "$line	

	fi
done < source.ini
SOURCEURL=($item_url)
#endee
commond_wget=$(which wget)
[ "${commond_wget:0-4}" == "wget" ] || (${AUTOINSTALL_COMMOND} -y install wget >/dev/null 2&1)
if [ $? -ne 0 ];then
	echo -e "\033[41;34mPlease install wget\033[0m"
	exit 1
fi
commond_grep=$(which grep)
[ "${commond_grep:0-4}" == "grep" ] || (${AUTOINSTALL_COMMOND} -y install grep >/dev/null 2&1)
if [ $? -ne 0 ];then
	echo -e "\033[41;34mPlease install grep\033[0m"
	exit 1
fi
commond_tar=$(which tar)
[ "${commond_tar:0-3}" == "tar" ] || (${AUTOINSTALL_COMMOND} -y install tar >/dev/null 2&1)
if [ $? -ne 0 ];then
	echo -e "\033[41;34mPlease install tar\033[0m"
	exit 1
fi
commond_unzip=$(which unzip)
[ "${commond_unzip:0-5}" == "unzip" ] || (${AUTOINSTALL_COMMOND} -y install unzip >/dev/null 2&1)
if [ $? -ne 0 ];then
	echo -e "\033[41;34mPlease install unzip\033[0m"
	exit 1
fi
. auto/package
#install software
sh auto/stow/stow



